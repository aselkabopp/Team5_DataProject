create or replace view "TARGITO_207F62E1-FC2D-4D55-9C5C-B800034DCC62".ANALYSIS.IA_ORDERS_NEW(
	CONTACT_ID,
	MAILING_ID,
	MAILING_DATE,
	CREATED_DATE,
	UPDATED_DATE,
	ORIGIN,
	ORDER_ID,
	TOTAL,
	TOTAL_VAT,
	IS_CANCELLED,
	PRODUCTS,
	ATTRIBUTES,
	REQUEST_INFO,
	SKLAD,
	GENDER_NEW,
	SOURCE
) as (
select 	a.CONTACT_ID,
	a.MAILING_ID,
	a.MAILING_DATE,
	a.CREATED_DATE,
	a.UPDATED_DATE,
	a.ORIGIN,
	a.ORDER_ID,
	a.TOTAL,
	a.TOTAL_VAT,
	a.IS_CANCELLED,
	a.PRODUCTS,
	a.ATTRIBUTES,
	a.REQUEST_INFO,
	CASE 
        WHEN JSON_EXTRACT_PATH_TEXT(ATTRIBUTES, 'cislo_skladu') = '002'
        THEN 'e-shop'
        ELSE 'store'
    END sklad,
   CASE WHEN b.GENDER_NEW is null  
       THEN 'unknown'
    ELSE b.GENDER_NEW
    END AS GENDER_NEW,
    CASE 
        WHEN b.source is null 
        THEN 'unknown'
        ELSE b.source
    END source
from "TARGITO_207F62E1-FC2D-4D55-9C5C-B800034DCC62".PUBLIC.ORDERS as a 
left join "TARGITO_207F62E1-FC2D-4D55-9C5C-B800034DCC62".ANALYSIS.CONTACTS_EXTENDED as b 
on a.CONTACT_ID =  b.ID
where a.is_cancelled = 'FALSE'
);